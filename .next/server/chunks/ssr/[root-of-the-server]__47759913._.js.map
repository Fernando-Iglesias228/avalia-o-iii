{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/fernando.iglesias/Desktop/%C3%9Atil/UFMS/Proj%20Integrador%20II/Avaliacao-iii/src/app/MapaDengue/Mapa/page.js"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport { GeoSearchControl, OpenStreetMapProvider } from 'leaflet-geosearch';\r\nimport 'leaflet-geosearch/dist/geosearch.css';\r\n\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: '/images/marker-icon-2x.png',\r\n  iconUrl: '/images/marker-icon.png',\r\n  shadowUrl: '/images/marker-shadow.png',\r\n});\r\n\r\nexport default function MapLeaflet({ allMarkers = [], onMarkerDelete }) {\r\n  useEffect(() => {\r\n    const map = L.map('map').setView([-20.4697, -54.6201], 13);\r\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n    }).addTo(map);\r\n\r\n    const provider = new OpenStreetMapProvider();\r\n    const searchControl = new GeoSearchControl({\r\n      provider,\r\n      style: 'bar',\r\n      showMarker: true,\r\n      autoClose: true,\r\n      retainZoomLevel: false,\r\n      animateZoom: true,\r\n    });\r\n    map.addControl(searchControl);\r\n\r\n    const dengueIcon = L.icon({\r\n      iconUrl: 'https://cdn-icons-png.flaticon.com/512/484/484167.png',\r\n      iconSize: [32, 32],\r\n      iconAnchor: [16, 32],\r\n      popupAnchor: [0, -32],\r\n    });\r\n\r\n    allMarkers.forEach((marker) => {\r\n      const popupContent = `\r\n        <div class=\"leaflet-popup-content-wrapper\">\r\n          <div class=\"leaflet-popup-content\">\r\n            <b>Foco de Dengue</b><br>\r\n            <small>${marker.nome || 'NÃ£o informado'}</small><br>\r\n            <small>${marker.endereco}</small><br>\r\n            <small>Tipo: ${marker.tipo}</small><br>\r\n            ${marker.data_registro ? `<small>Registrado em: ${new Date(marker.data_registro).toLocaleDateString()}</small>` : ''}\r\n            <div class=\"d-grid gap-2 mt-2\">\r\n              <button \r\n                class=\"btn btn-sm btn-danger delete-btn\" \r\n                data-id=\"${marker.id}\"\r\n                style=\"width: 100%\"\r\n              >\r\n                Remover Foco\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      const leafletMarker = L.marker([marker.lat, marker.lng], { icon: dengueIcon })\r\n        .addTo(map)\r\n        .bindPopup(popupContent);\r\n\r\n      leafletMarker.on('popupopen', () => {\r\n        const deleteBtn = document.querySelector(`.delete-btn[data-id=\"${marker.id}\"]`);\r\n        if (deleteBtn) {\r\n          deleteBtn.addEventListener('click', async (e) => {\r\n            e.stopPropagation();\r\n            if (confirm('Tem certeza que deseja remover este foco?')) {\r\n              try {\r\n                const response = await fetch(`/api/focos/${marker.id}`, {\r\n                  method: 'DELETE',\r\n                });\r\n\r\n                if (response.ok) {\r\n                  if (onMarkerDelete) onMarkerDelete(marker.id);\r\n                  leafletMarker.remove();\r\n                  map.closePopup();\r\n                } else {\r\n                  throw new Error('Falha ao remover foco');\r\n                }\r\n              } catch (error) {\r\n                console.error('Erro ao remover marcador:', error);\r\n                alert('Erro ao remover foco: ' + error.message);\r\n              }\r\n            }\r\n          });\r\n        }\r\n      });\r\n    });\r\n\r\n    if (allMarkers.length > 0) {\r\n      const group = new L.featureGroup(allMarkers.map(m => L.marker([m.lat, m.lng])));\r\n      map.fitBounds(group.getBounds().pad(0.2));\r\n    }\r\n\r\n    return () => {\r\n      map.remove();\r\n    };\r\n  }, [allMarkers, onMarkerDelete]);\r\n\r\n  return <div id=\"map\" style={{ height: '500px', width: '100%' }} />;\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}