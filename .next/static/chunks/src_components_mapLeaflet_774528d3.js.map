{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/fernando.iglesias/Desktop/%C3%9Atil/UFMS/Proj%20Integrador%20II/Avaliacao-iii/src/components/mapLeaflet.js"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport { GeoSearchControl, OpenStreetMapProvider } from 'leaflet-geosearch';\r\nimport 'leaflet-geosearch/dist/geosearch.css';\r\n\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: '/images/marker-icon-2x.png',\r\n  iconUrl: '/images/marker-icon.png',\r\n  shadowUrl: '/images/marker-shadow.png',\r\n});\r\n\r\nexport default function MapLeaflet({ allMarkers = [], onMarkerDelete }) {\r\n  useEffect(() => {\r\n    const map = L.map('map').setView([-20.4697, -54.6201], 13);\r\n\r\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n    }).addTo(map);\r\n\r\n    const provider = new OpenStreetMapProvider();\r\n    const searchControl = new GeoSearchControl({\r\n      provider,\r\n      style: 'bar',\r\n      showMarker: true,\r\n      autoClose: true,\r\n    });\r\n    map.addControl(searchControl);\r\n\r\n    const dengueIcon = L.icon({\r\n      iconUrl: 'https://cdn-icons-png.flaticon.com/512/484/484167.png',\r\n      iconSize: [32, 32],\r\n      iconAnchor: [16, 32],\r\n      popupAnchor: [0, -32],\r\n    });\r\n\r\n    allMarkers.forEach((marker) => {\r\n      const hasImage = marker.imagem && marker.imagem !== 'null';\r\n      \r\n      const popupContent = `\r\n        <div class=\"leaflet-popup-content-wrapper\">\r\n          <div class=\"leaflet-popup-content\">\r\n            <b>Foco de Dengue</b><br>\r\n            <small>${marker.nome || 'NÃ£o informado'}</small><br>\r\n            <small>${marker.endereco}</small><br>\r\n            <small>Tipo: ${marker.tipo}</small><br>\r\n            ${marker.data_registro ? `<small>Registrado em: ${new Date(marker.data_registro).toLocaleDateString()}</small>` : ''}\r\n            <div class=\"d-flex gap-2 mt-2\">\r\n              ${hasImage ? `\r\n                <button \r\n                  class=\"btn btn-sm btn-primary view-btn flex-grow-1\" \r\n                  data-id=\"${marker.id}\"\r\n                  data-image=\"${marker.imagem}\"\r\n                >\r\n                  Ver Foto\r\n                </button>\r\n              ` : ''}\r\n              <button \r\n                class=\"btn btn-sm btn-danger delete-btn flex-grow-1\" \r\n                data-id=\"${marker.id}\"\r\n              >\r\n                Remover\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      const leafletMarker = L.marker([marker.lat, marker.lng], { icon: dengueIcon })\r\n        .addTo(map)\r\n        .bindPopup(popupContent);\r\n\r\n      leafletMarker.on('popupopen', () => {\r\n        const viewBtn = document.querySelector(`.view-btn[data-id=\"${marker.id}\"]`);\r\n        if (viewBtn) {\r\n          viewBtn.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n            const imageUrl = viewBtn.getAttribute('data-image');\r\n            window.open(imageUrl, '_blank');\r\n          });\r\n        }\r\n\r\n        const deleteBtn = document.querySelector(`.delete-btn[data-id=\"${marker.id}\"]`);\r\n        if (deleteBtn) {\r\n          deleteBtn.addEventListener('click', async (e) => {\r\n            e.stopPropagation();\r\n            if (confirm('Tem certeza que deseja remover este foco?')) {\r\n              try {\r\n                const response = await fetch(`/api/focos/${marker.id}`, {\r\n                  method: 'DELETE',\r\n                });\r\n\r\n                if (response.ok) {\r\n                  if (onMarkerDelete) onMarkerDelete(marker.id);\r\n                  leafletMarker.remove();\r\n                  map.closePopup();\r\n                } else {\r\n                  throw new Error('Falha ao remover foco');\r\n                }\r\n              } catch (error) {\r\n                console.error('Erro ao remover marcador:', error);\r\n                alert('Erro ao remover foco: ' + error.message);\r\n              }\r\n            }\r\n          });\r\n        }\r\n      });\r\n    });\r\n\r\n    if (allMarkers.length > 0) {\r\n      const group = new L.featureGroup(allMarkers.map(m => L.marker([m.lat, m.lng])));\r\n      map.fitBounds(group.getBounds().pad(0.2));\r\n    }\r\n\r\n    return () => {\r\n      map.remove();\r\n    };\r\n  }, [allMarkers, onMarkerDelete]);\r\n\r\n  return <div id=\"map\" style={{ height: '500px', width: '100%' }} />;\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}